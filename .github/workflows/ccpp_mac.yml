name: C/C++ Nigthly macos

on: push
    
#on:
#  push:
#    branches:
#      - Nigthly

jobs:
  build:

    runs-on: macos-latest
    
    steps:
    - uses: actions/checkout@v2
      with:
        ref: 'Nigthly'
    - name: update submodule profiles
      working-directory: ./resources/profiles
      run: git submodule update --init
    - name: change date in version
      run: |
        sed "s/+UNKNOWN/_$(date '+%F')/" version.inc > version.date.inc
        mv version.date.inc version.inc
    - name: BuildMacOS amd64
      run: ./BuildMacOS.sh -ia
      
    - name: BuildMacOS arm64
      run: ./BuildMacOS.sh -ix

#    - name: signing Resources (creating CodeResources inside _CodeSignature)
#      working-directory: .
#      run: codesign -s <identity> Resources
# maybe i should just try to do that on a separate pc and copy the file here, more secure as a signing process.
    - name: Upload artifact
      uses: actions/upload-artifact@v1.0.0
      with:
        name: nightly_macos.tar
        path: build/SuperSlicer.tar
    - name: Upload artifact
      uses: actions/upload-artifact@v1.0.0
      with:
        name: nightly_macos.dmg
        path: build/SuperSlicer.dmg
